<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>How to Access Meshes in AIRSIM - AirSim</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "How to Access Meshes in AIRSIM";
    var mkdocs_page_input_path = "meshes.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> AirSim</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../CHANGELOG/">Whats New</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Get AirSim</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../use_precompiled/">Download Binaries</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../build_windows/">Build on Windows</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../build_linux/">Build on Linux</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../unreal_custenv/">Creating Custom Environment</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Using AirSim</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../apis/">Core APIs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../image_apis/">Image APIs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../apis_cpp/">C++ APIs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../dev_workflow/">Development Workflow</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../settings/">Settings</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../camera_views/">Camera Views</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../using_car/">Using Car</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../remote_control/">Remote Control</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../xbox_controller/">XBox Controller</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../steering_wheel_installation/">Steering Wheel</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../multi_vehicle/">Multiple Vehicles</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../sensors/">Sensors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../lidar/">LIDAR</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ros/">ROS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../playback/">Playing Logs</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Design</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../design/">Architecture</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../code_structure/">Code Structure</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../coding_guidelines/">Coding Guidelines</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../flight_controller/">Flight Controller</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../simple_flight/">Simple Flight</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../hello_drone/">Hello Drone</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">MavLink and PX4</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../px4_setup/">PX4 Setup for AirSim</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../px4_sitl/">PX4 in SITL</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://youtu.be/1oY8Qu5maQQ">AirSim with Pixhawk</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://youtu.be/HNWdYrtw3f0">PX4 Setup with AirSim</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://www.youtube.com/watch?v=d_FyjKDWQfc&feature=youtu.be">Debugging Attitude Estimation</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Intercepting-MavLink-messages">Intercepting MavLink Messages</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Rapid-Descent-on-PX4-drones">Rapid Descent on PX4 Drones</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../px4_build/">Building PX4</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../px4_logging/">PX4/MavLink Logging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../log_viewer/">MavLink LogViewer</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Upgrading</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../unreal_upgrade/">Upgrading Unreal</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../upgrade_apis/">Upgrading APIs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../upgrade_settings/">Upgrading Settings</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Contributed Tutorials</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../reinforcement_learning/">Reinforcement Learning</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://www.youtube.com/watch?v=y09VbdQWvQY">Using Environments from Marketplace</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/simondlevy/AirSimTensorFlow">Simple Collision Avoidance</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://aka.ms/AutonomousDrivingCookbook">Autonomous Driving on Azure</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/hexacopter">Building Hexacopter</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/moveOnPath-demo">Moving on Path Demo</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Point-Clouds">Building Point Clouds</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Implementing-a-Drone-Survey-script">Surveying Using Drone</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Misc</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../custom_drone/">AirSim on Real Drones</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cmake_linux/">Installing cmake on Linux</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../hard_drive/">Tips for Busy HDD</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pfm/">pfm format</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../unreal_proj/">Setting up Unreal Environment</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../unreal_blocks/">Blocks Environment</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../who_is_using/">Who is Using AirSim</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../working_with_plugin_contents/">Working with UE Plugin Contents</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/technion">Formula Student Technion Self-drive</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Support</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../SUPPORT/">Support</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../create_issue/">Create Issue</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/">Contribute</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">AirSim</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>How to Access Meshes in AIRSIM</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/microsoft/airsim/edit/master/docs/meshes.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="how-to-access-meshes-in-airsim">How to Access Meshes in AIRSIM<a class="headerlink" href="#how-to-access-meshes-in-airsim" title="Permanent link">#</a></h1>
<p>AirSim supports the ability to access the static meshes that make up the scene</p>
<h2 id="mesh-structure">Mesh structure<a class="headerlink" href="#mesh-structure" title="Permanent link">#</a></h2>
<p>Each mesh is represented with the below struct.</p>
<pre><code>struct MeshPositionVertexBuffersResponse {

    Vector3r position;
    Quaternionr orientation;

    std::vector&lt;float&gt; vertices;
    std::vector&lt;uint32_t&gt; indices;
    std::string name;
};
</code></pre>

<ul>
<li>The position and orientation are in the Unreal coordinate system.</li>
<li>The mesh itself is a triangular mesh represented by the vertices and the indices.<ul>
<li>The triangular mesh type is typically called a <a href="https://en.wikipedia.org/wiki/Polygon_mesh#Face-vertex_meshes">Face-Vertex</a> Mesh. This means every triplet of indices hold the indexes of the vertices that make up the triangle/face.</li>
<li>The x,y,z coordinates of the vertices are all stored in a single vector. This means the vertices vertices is Nx3 where N is number of vertices. </li>
<li>The position of the vertices are the global positions in the Unreal coordinate system. This means they have already been Transformed by the position and orientation.</li>
</ul>
</li>
<li></li>
</ul>
<h2 id="how-to-use">How to use<a class="headerlink" href="#how-to-use" title="Permanent link">#</a></h2>
<p>The API to get the meshes in the scene is quite simple. However, one should note that the function call is very expensive and should
 very rarely be called. In general this is ok because this function only accesses the static meshes which for most applications are
 not changing during the duration of your program.</p>
<p>Note that you will have to use a 3rdparty library or your own custom code to actually interact with the recieved meshes. Below I utilize the
python bindings of <a href="https://github.com/libigl/libigl">libigl</a> to visualize the recieved meshes.</p>
<pre><code>import airsim

AIRSIM_HOST_IP='127.0.0.1'

client = airsim.VehicleClient(ip=AIRSIM_HOST_IP)
client.confirmConnection()

# List of returned meshes are received via this function
meshes=client.simGetMeshPositionVertexBuffers()


index=0
for m in meshes:
    # Finds one of the cube meshes in the Blocks environment
    if 'cube' in m.name:

        # Code from here on relies on libigl. Libigl uses pybind11 to wrap C++ code. So here the built pyigl.so
        # library is in the same directory as this example code.
        # This is here as code for your own mesh library should require something similar
        from pyigl import *
        from iglhelpers import *

        # Convert the lists to numpy arrays
        vertex_list=np.array(m.vertices,dtype=np.float32)
        indices=np.array(m.indices,dtype=np.uint32)

        num_vertices=int(len(vertex_list)/3)
        num_indices=len(indices)

        # Libigl requires the shape to be Nx3 where N is number of vertices or indices
        # It also requires the actual type to be double(float64) for vertices and int64 for the triangles/indices
        vertices_reshaped=vertex_list.reshape((num_vertices,3))
        indices_reshaped=indices.reshape((int(num_indices/3),3))
        vertices_reshaped=vertices_reshaped.astype(np.float64)
        indices_reshaped=indices_reshaped.astype(np.int64)

        #Libigl function to convert to internal Eigen format
        v_eig=p2e(vertices_reshaped)
        i_eig=p2e(indices_reshaped)

        # View the mesh
        viewer = igl.glfw.Viewer()
        viewer.data().set_mesh(v_eig,i_eig)
        viewer.launch()
        break
</code></pre>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2018 Microsoft Research</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/microsoft/airsim/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
